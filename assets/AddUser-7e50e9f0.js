import{W as w,j as e,n as R,m as $,au as H,Y as x,av as Y,r as o,v as _,C as q,I as v,S as G}from"./index-6881a38b.js";import{B as J}from"./Breadcrumb-463c378a.js";import{B as L}from"./Box-d449a0b0.js";import{B as n}from"./Button-ff562e0b.js";import{C as K}from"./CircularProgress-8429f72f.js";import{T as Q,a as X,b as U,c as t,d as Z}from"./TableRow-d0664d59.js";import{T as y}from"./Tooltip-35b78d57.js";import{D as P,a as b}from"./DialogContent-f1adb223.js";import{D}from"./DialogTitle-7dff730c.js";import{T as d}from"./TextField-7f727abd.js";import{D as S}from"./DialogActions-bbf09e0d.js";import"./index.esm-522351cb.js";import"./Grid-132cce37.js";import"./Link-585f2144.js";import"./Popper-aa3de15e.js";import"./Portal-343632f1.js";import"./useControlled-4f8eaaf0.js";import"./useId-c7e897e5.js";import"./Modal-04cf2a2a.js";import"./Fade-577ca4d2.js";import"./ownerWindow-71250041.js";import"./createChainedFunction-0bab83cf.js";import"./FormControl-8f5e2d3c.js";import"./utils-a73c94d0.js";import"./useFormControl-d4f0b139.js";import"./isMuiElement-4897e4b7.js";import"./formControlState-a1fb9590.js";import"./Select-d12d8e0d.js";import"./Popover-40bbd40c.js";import"./List-9cc45e96.js";const ee=w(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),se=w(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete"),ae=w(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit"),te=w(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"}),"Lock"),re=()=>{const i=R(),{users:j,loading:c}=$(a=>a.users);return{users:j,loading:c,getUsers:async()=>{i(H(!0));try{const a=await x.get("/user/getUsers");a.data.success&&i(Y(a.data.users))}catch(a){console.error("Fetch users failed",a)}finally{i(H(!1))}},addUser:async a=>{console.log(a),await x.post("/user/addUser",a)},updateUser:async(a,h)=>await x.put(`/user/updateUser/${a}`,h),deleteUser:async a=>await x.delete(`/user/deleteUser/${a}`),changePassword:async(a,h)=>await x.put(`/user/userChangePassword/${a}`,h)}},le=[{to:"/",title:"Home"},{title:"Users"}],Be=()=>{const{users:i,loading:j,getUsers:c,addUser:k,updateUser:z,deleteUser:I,changePassword:T}=re(),[M,a]=o.useState(!1),[h,f]=o.useState(!1),[W,g]=o.useState({open:!1,userId:null}),[m,E]=o.useState(null),[r,u]=o.useState({name:"",email:"",role:"",password:""}),[p,A]=o.useState({currentPassword:"",newPassword:""}),[C,l]=o.useState({open:!1,message:""});_(),o.useEffect(()=>{c()},[]);const B=(s=null)=>{E(s),u(s?{name:s.name,email:s.email,role:s.role,password:""}:{name:"",email:"",role:"",password:""}),a(!0)},V=async()=>{try{m?(await z(m.id,r),l({open:!0,message:"User updated successfully"})):(await k(r),l({open:!0,message:"User added successfully"})),c(),a(!1)}catch{l({open:!0,message:"Error saving user"})}},F=s=>{g({open:!0,userId:s})},N=async()=>{try{await I(W.userId),c(),l({open:!0,message:"User deleted"})}catch{l({open:!0,message:"Delete failed"})}finally{g({open:!1,userId:null})}},O=async()=>{try{await T(m.id,p),l({open:!0,message:"Password updated"}),f(!1)}catch{l({open:!0,message:"Password update failed"})}};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Users",items:le}),e.jsxs(q,{variant:"outlined",sx:{p:2,mt:2},children:[e.jsx(L,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsx(n,{startIcon:e.jsx(ee,{}),variant:"contained",onClick:()=>B(),children:"Add User"})}),j?e.jsx(K,{}):e.jsxs(Q,{children:[e.jsx(X,{children:e.jsxs(U,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(t,{children:"ID"}),e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Created At"}),e.jsx(t,{children:"Actions"})]})}),e.jsxs(Z,{children:[i.map(s=>e.jsxs(U,{hover:!0,children:[e.jsx(t,{children:s.id}),e.jsx(t,{children:s.name}),e.jsx(t,{children:s.email}),e.jsx(t,{children:s.role}),e.jsx(t,{children:new Date(s.created_at).toLocaleString()}),e.jsx(t,{children:e.jsxs(L,{display:"flex",gap:1,children:[e.jsx(y,{title:"Edit",children:e.jsx(v,{color:"primary",onClick:()=>B(s),children:e.jsx(ae,{fontSize:"small"})})}),e.jsx(y,{title:"Delete",children:e.jsx(v,{color:"error",onClick:()=>F(s.id),children:e.jsx(se,{fontSize:"small"})})}),e.jsx(y,{title:"Change Password",children:e.jsx(v,{onClick:()=>{E(s),f(!0)},children:e.jsx(te,{fontSize:"small"})})})]})})]},s.id)),i.length===0&&e.jsx(U,{children:e.jsx(t,{colSpan:6,align:"center",children:j?"Loading...":"No users found"})})]})]})]}),e.jsxs(P,{open:M,onClose:()=>a(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(D,{children:m?"Edit User":"Add User"}),e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(d,{label:"Name",value:r.name,onChange:s=>u({...r,name:s.target.value}),fullWidth:!0}),e.jsx(d,{label:"Email",value:r.email,onChange:s=>u({...r,email:s.target.value}),fullWidth:!0}),e.jsx(d,{label:"Role",value:r.role,onChange:s=>u({...r,role:s.target.value}),fullWidth:!0}),!m&&e.jsx(d,{label:"Password",type:"password",value:r.password,onChange:s=>u({...r,password:s.target.value}),fullWidth:!0})]}),e.jsxs(S,{children:[e.jsx(n,{onClick:()=>a(!1),children:"Cancel"}),e.jsx(n,{onClick:V,variant:"contained",children:"Save"})]})]}),e.jsxs(P,{open:h,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(D,{children:"Change Password"}),e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(d,{label:"Current Password",type:"password",value:p.currentPassword,onChange:s=>A({...p,currentPassword:s.target.value}),fullWidth:!0}),e.jsx(d,{label:"New Password",type:"password",value:p.newPassword,onChange:s=>A({...p,newPassword:s.target.value}),fullWidth:!0})]}),e.jsxs(S,{children:[e.jsx(n,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(n,{onClick:O,variant:"contained",children:"Update"})]})]}),e.jsxs(P,{open:W.open,onClose:()=>g({open:!1,userId:null}),children:[e.jsx(D,{children:"Confirm Delete"}),e.jsx(b,{children:"Are you sure you want to delete this user?"}),e.jsxs(S,{children:[e.jsx(n,{onClick:()=>g({open:!1,userId:null}),children:"Cancel"}),e.jsx(n,{variant:"contained",color:"error",onClick:N,children:"Delete"})]})]}),e.jsx(G,{open:C.open,autoHideDuration:3e3,onClose:()=>l({...C,open:!1}),message:C.message,anchorOrigin:{vertical:"bottom",horizontal:"right"}})]})};export{Be as default};
