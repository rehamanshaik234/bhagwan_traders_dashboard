import{n as U,m as $,r as o,J as k,K as z,M as A,j as e,C as H,S as F,D as J,v as K,I as m}from"./index-6881a38b.js";import{d as v,a as y,b as T,c as I}from"./LastPage-50f3a6a1.js";import{B as Y}from"./Breadcrumb-463c378a.js";import{T as q}from"./TableContainer-0ad4f5c4.js";import{T as G,a as Q,b as x,c as i,d as V}from"./TableRow-d0664d59.js";import{C as W}from"./Chip-800657f9.js";import{B as C}from"./Button-ff562e0b.js";import{C as X}from"./CircularProgress-8429f72f.js";import{T as Z}from"./TableFooter-169d4b91.js";import{T as ee}from"./TablePagination-5840844c.js";import{D as te,a as re}from"./DialogContent-f1adb223.js";import{D as ne}from"./DialogTitle-7dff730c.js";import{D as se}from"./DialogContentText-2adaa8cb.js";import{D as ie}from"./DialogActions-bbf09e0d.js";import{B as oe}from"./Box-c0f8832c.js";import"./createSvgIcon-e0680651.js";import"./createChainedFunction-0bab83cf.js";import"./ownerWindow-71250041.js";import"./isMuiElement-4897e4b7.js";import"./useId-c7e897e5.js";import"./useControlled-4f8eaaf0.js";import"./index.esm-522351cb.js";import"./Grid-132cce37.js";import"./Box-d449a0b0.js";import"./Link-585f2144.js";import"./KeyboardArrowRight-b6f9714b.js";import"./Toolbar-f3beb080.js";import"./Select-d12d8e0d.js";import"./Popover-40bbd40c.js";import"./Modal-04cf2a2a.js";import"./Fade-577ca4d2.js";import"./Portal-343632f1.js";import"./List-9cc45e96.js";import"./utils-a73c94d0.js";import"./formControlState-a1fb9590.js";import"./useFormControl-d4f0b139.js";import"./MenuItem-0a5cd614.js";import"./listItemTextClasses-0a907018.js";import"./dividerClasses-f2209139.js";const ae=()=>{const r=U(),{pendingOrders:a,loading:n}=$(u=>u.orders),[d,l]=o.useState(null);o.useEffect(()=>{r(k())},[r]);const c=o.useCallback(()=>{r(k())},[r]);return{pendingOrders:a,loading:n,btnLoadingId:d,handleStatusUpdate:async u=>{l(u);try{await r(z({orderId:u,newStatus:"Dispatched"})).unwrap()}finally{l(null)}},refetchPendingOrders:c}};function de(){const{on:r,off:a}=A(),[n,d]=o.useState([]);return o.useEffect(()=>(r("dispatched_order",l=>{const c=l.data;d(s=>[c,...s.filter(u=>u.id!==l.orderId)])}),()=>{a("dispatched_order")}),[r,a]),{orders:n}}const le=[{to:"/",title:"Home"},{title:"Pending Orders"}];function ce(r){const a=K(),{count:n,page:d,rowsPerPage:l,onPageChange:c}=r;return e.jsxs(oe,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(m,{onClick:s=>c(s,0),disabled:d===0,children:a.direction==="rtl"?e.jsx(v,{}):e.jsx(y,{})}),e.jsx(m,{onClick:s=>c(s,d-1),disabled:d===0,children:a.direction==="rtl"?e.jsx(T,{}):e.jsx(I,{})}),e.jsx(m,{onClick:s=>c(s,d+1),disabled:d>=Math.ceil(n/l)-1,children:a.direction==="rtl"?e.jsx(I,{}):e.jsx(T,{})}),e.jsx(m,{onClick:s=>c(s,Math.max(0,Math.ceil(n/l)-1)),disabled:d>=Math.ceil(n/l)-1,children:a.direction==="rtl"?e.jsx(y,{}):e.jsx(v,{})})]})}const Xe=()=>{const[r,a]=o.useState(0),[n,d]=o.useState(5),[l,c]=o.useState(!1),[s,u]=o.useState(null),[P,g]=o.useState(null),[b,_]=o.useState(!1),{on:S,off:D,emit:B}=A();de();const{pendingOrders:p,loading:ue,btnLoadingId:f,handleStatusUpdate:he,refetchPendingOrders:E}=ae();o.useEffect(()=>{const t=()=>{_(!0),window.removeEventListener("click",t)};return window.addEventListener("click",t),()=>{window.removeEventListener("click",t)}},[]);const L=t=>{u(t),c(!0)},j=()=>{c(!1),u(null)},N=async()=>{s&&(B("dispatch_order",{orderId:s,status:"Dispatched"}),await E(),w(),j())},w=()=>{if(!b){console.warn("Audio blocked: no user interaction yet");return}new Audio("/sound/notification.mp3").play().catch(h=>{console.error("Audio playback failed:",h)})},M=(t,h)=>a(h),R=t=>{d(parseInt(t.target.value,10)),a(0)},O=r>0?Math.max(0,(1+r)*n-p.length):0;return o.useEffect(()=>{const t=h=>{console.log("New order received:",h),g(`${h.message} - orderId: ${h.data.order_id}`),w()};return S("new_order",t),()=>{D("new_order",t)}},[S,D,b]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Pending Orders",items:le}),e.jsxs(H,{variant:"outlined",children:[e.jsx(q,{children:e.jsxs(G,{sx:{whiteSpace:"nowrap"},children:[e.jsx(Q,{children:e.jsxs(x,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(i,{children:"Order ID"}),e.jsx(i,{children:"Customer ID"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Total Amount"}),e.jsx(i,{children:"Created At"}),e.jsx(i,{children:"Actions"})]})}),e.jsxs(V,{children:[(n>0?p.slice(r*n,r*n+n):p).map(t=>e.jsxs(x,{children:[e.jsx(i,{children:t.id}),e.jsx(i,{children:t.customer_id}),e.jsx(i,{children:e.jsx(W,{label:t.status,color:"warning",size:"small"})}),e.jsxs(i,{children:["$",t.total_amount]}),e.jsxs(i,{children:[new Date(t.created_at).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})," ",new Date(t.created_at).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0})]}),e.jsx(i,{children:e.jsx(C,{variant:"contained",size:"small",disabled:f===t.id,onClick:()=>L(t.id),startIcon:f===t.id?e.jsx(X,{size:18,color:"inherit"}):null,children:f===t.id?"Updating...":"Dispatch"})})]},t.id)),O>0&&e.jsx(x,{style:{height:53*O},children:e.jsx(i,{colSpan:6})})]}),e.jsx(Z,{children:e.jsx(x,{children:e.jsx(ee,{rowsPerPageOptions:[5,10,25,{label:"All",value:-1}],colSpan:6,count:p.length,rowsPerPage:n,page:r,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},onPageChange:M,onRowsPerPageChange:R,ActionsComponent:ce})})})]})}),e.jsxs(te,{open:l,onClose:j,children:[e.jsx(ne,{children:"Confirm Dispatch"}),e.jsx(re,{children:e.jsx(se,{children:"Are you sure you want to mark this order as dispatched?"})}),e.jsxs(ie,{children:[e.jsx(C,{onClick:j,color:"secondary",children:"Cancel"}),e.jsx(C,{onClick:N,color:"primary",variant:"contained",children:"Yes, Dispatch"})]})]})]}),e.jsx(F,{open:!!P,autoHideDuration:4e3,onClose:()=>g(null),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(J,{severity:"info",onClose:()=>g(null),variant:"filled",children:P})})]})};export{Xe as default};
